# æ¯æ—¥è‚¡ç¥¨æ‰«æç³»ç»Ÿ - å®Œæ•´å®æ–½æ¸…å•

## ğŸ“¦ é¡¹ç›®æ–‡ä»¶æ¸…å•

### åç«¯æ–‡ä»¶
```
backend/
â”œâ”€â”€ scheduler/
â”‚   â”œâ”€â”€ __init__.py                    # æ¨¡å—åˆå§‹åŒ–
â”‚   â”œâ”€â”€ daily_scanner.py              # âœ… æ ¸å¿ƒæ‰«æå™¨
â”‚   â”œâ”€â”€ scheduler_manager.py          # âœ… å®šæ—¶ä»»åŠ¡ç®¡ç†
â”‚   â””â”€â”€ config.yaml                   # âœ… é…ç½®æ–‡ä»¶
â”‚
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ __init__.py                   # æ¨¡å—åˆå§‹åŒ–
â”‚   â””â”€â”€ ticker_utils.py               # âœ… è‚¡ç¥¨ä»£ç å·¥å…·
â”‚
â”œâ”€â”€ data/                             # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ nas100.md                     # Nasdaq 100åˆ—è¡¨
â”‚   â”œâ”€â”€ sp500.md                      # S&P 500åˆ—è¡¨
â”‚   â”œâ”€â”€ combined_tickers.md           # åˆå¹¶å»é‡åˆ—è¡¨
â”‚   â”œâ”€â”€ rankings_combined.json        # å®Œæ•´æ’åç»“æœ
â”‚   â”œâ”€â”€ rankings_top20.json           # å‰20åï¼ˆå¿«é€Ÿè®¿é—®ï¼‰
â”‚   â”œâ”€â”€ scan_progress.txt             # æ‰«æè¿›åº¦è®°å½•
â”‚   â”œâ”€â”€ scan_log.txt                  # æ‰«ææ—¥å¿—
â”‚   â””â”€â”€ scheduler.log                 # å®šæ—¶ä»»åŠ¡æ—¥å¿—
â”‚
â””â”€â”€ app.py                            # âš ï¸ éœ€è¦ä¿®æ”¹: æ·»åŠ æ–°APIç«¯ç‚¹
```

### å‰ç«¯æ–‡ä»¶
```
src/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ StrategyRank.tsx              # âœ… æ’åé¡µé¢ç»„ä»¶
â”‚
â”œâ”€â”€ locales/
â”‚   â”œâ”€â”€ en.json                       # âš ï¸ éœ€è¦ä¿®æ”¹: æ·»åŠ ç¿»è¯‘
â”‚   â”œâ”€â”€ zh.json                       # âš ï¸ éœ€è¦ä¿®æ”¹: æ·»åŠ ç¿»è¯‘
â”‚   â””â”€â”€ ja.json                       # âš ï¸ éœ€è¦ä¿®æ”¹: æ·»åŠ ç¿»è¯‘
â”‚
â””â”€â”€ App.tsx                           # âš ï¸ éœ€è¦ä¿®æ”¹: æ·»åŠ è·¯ç”±
```

### é…ç½®å’Œè„šæœ¬
```
project-root/
â”œâ”€â”€ requirements.txt                  # âœ… Pythonä¾èµ–
â”œâ”€â”€ quick_start.sh                    # âœ… å¿«é€Ÿå¯åŠ¨è„šæœ¬
â”œâ”€â”€ monitor.sh                        # ğŸ“ å¯é€‰: ç›‘æ§è„šæœ¬
â”œâ”€â”€ alert.sh                          # ğŸ“ å¯é€‰: å‘Šè­¦è„šæœ¬
â””â”€â”€ Dockerfile                        # ğŸ“ å¯é€‰: Dockeré…ç½®
```

---

## ğŸš€ å®æ–½æ­¥éª¤

### Phase 1: ç¯å¢ƒå‡†å¤‡ (15åˆ†é’Ÿ)

#### 1.1 å®‰è£…ä¾èµ–
```bash
# åˆ›å»ºrequirements.txt
cat > requirements.txt << EOF
yfinance>=0.2.36
apscheduler>=3.10.4
pytz>=2023.3
pandas>=2.0.0
requests>=2.31.0
pyyaml>=6.0
flask>=2.3.0
EOF

# å®‰è£…
pip3 install -r requirements.txt
```

#### 1.2 åˆ›å»ºç›®å½•ç»“æ„
```bash
mkdir -p backend/scheduler backend/data backend/utils
touch backend/__init__.py
touch backend/scheduler/__init__.py
touch backend/utils/__init__.py
```

#### 1.3 å¤åˆ¶æ ¸å¿ƒæ–‡ä»¶
å°†ä»¥ä¸‹å·²åˆ›å»ºçš„æ–‡ä»¶å¤åˆ¶åˆ°é¡¹ç›®:
- `daily_scanner.py` â†’ `backend/scheduler/`
- `scheduler_manager.py` â†’ `backend/scheduler/`
- `ticker_utils.py` â†’ `backend/utils/`
- `config.yaml` â†’ `backend/scheduler/`
- `quick_start.sh` â†’ é¡¹ç›®æ ¹ç›®å½•

---

### Phase 2: åˆå§‹åŒ–æ•°æ® (20åˆ†é’Ÿ)

#### 2.1 è·å–è‚¡ç¥¨åˆ—è¡¨

**æ–¹æ³•A: è‡ªåŠ¨è·å–ï¼ˆæ¨èï¼‰**
```bash
python3 backend/utils/ticker_utils.py --update
```

**æ–¹æ³•B: æ‰‹åŠ¨åˆ›å»º**
```bash
# Nasdaq 100 (100åªè‚¡ç¥¨)
cat > backend/data/nas100.md << EOF
AAPL
MSFT
GOOGL
AMZN
NVDA
...ï¼ˆå…±100ä¸ªï¼‰
EOF

# S&P 500 (500åªè‚¡ç¥¨)
cat > backend/data/sp500.md << EOF
AAPL
MSFT
...ï¼ˆå…±500ä¸ªï¼‰
EOF
```

#### 2.2 éªŒè¯æ•°æ®
```bash
# æ£€æŸ¥æ–‡ä»¶
ls -lh backend/data/*.md

# ç»Ÿè®¡æ•°é‡
wc -l backend/data/nas100.md
wc -l backend/data/sp500.md

# æŸ¥çœ‹å»é‡åçš„æ•°é‡
python3 backend/utils/ticker_utils.py --update
```

---

### Phase 3: åç«¯é›†æˆ (30åˆ†é’Ÿ)

#### 3.1 ä¿®æ”¹ Flask API
åœ¨ `backend/app.py` ä¸­æ·»åŠ :

```python
from flask import Flask, jsonify
import json
from pathlib import Path

app = Flask(__name__)

@app.route('/api/rankings', methods=['GET'])
def get_rankings():
    """è¿”å›æ‰€æœ‰æ’å"""
    try:
        with open('backend/data/rankings_combined.json', 'r') as f:
            data = json.load(f)
        return jsonify(data)
    except FileNotFoundError:
        return jsonify({'error': 'Rankings not available yet'}), 404

@app.route('/api/rankings/top20', methods=['GET'])
def get_top20():
    """è¿”å›å‰20åï¼ˆå¿«é€Ÿå“åº”ï¼‰"""
    try:
        with open('backend/data/rankings_top20.json', 'r') as f:
            data = json.load(f)
        return jsonify(data)
    except FileNotFoundError:
        return jsonify({'error': 'Rankings not available yet'}), 404

@app.route('/api/rankings/status', methods=['GET'])
def get_scan_status():
    """è¿”å›æ‰«æçŠ¶æ€"""
    progress_file = Path('backend/data/scan_progress.txt')
    
    if not progress_file.exists():
        return jsonify({'status': 'no_data'})
    
    from datetime import datetime
    today = datetime.now().strftime('%Y-%m-%d')
    
    total = 0
    success = 0
    
    with open(progress_file, 'r') as f:
        for line in f:
            if today in line:
                total += 1
                if 'SUCCESS' in line:
                    success += 1
    
    return jsonify({
        'status': 'completed' if total > 500 else 'in_progress',
        'date': today,
        'progress': success,
        'total': total
    })
```

#### 3.2 æµ‹è¯•API
```bash
# å¯åŠ¨Flask
python3 backend/app.py

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯æµ‹è¯•
curl http://localhost:5000/api/rankings/status
curl http://localhost:5000/api/rankings/top20
```

---

### Phase 4: å‰ç«¯é›†æˆ (30åˆ†é’Ÿ)

#### 4.1 åˆ›å»ºç»„ä»¶
å°† `StrategyRank.tsx` å¤åˆ¶åˆ° `src/components/`

#### 4.2 æ·»åŠ è·¯ç”±
åœ¨ `src/App.tsx` ä¸­:

```typescript
import { BrowserRouter, Routes, Route } from 'react-router-dom';
import StrategyRank from './components/StrategyRank';

function App() {
  return (
    <BrowserRouter>
      <Routes>
        <Route path="/" element={<Home />} />
        <Route path="/rank" element={<StrategyRank />} />
      </Routes>
    </BrowserRouter>
  );
}
```

#### 4.3 æ·»åŠ ç¿»è¯‘
åœ¨ `src/locales/en.json`:
```json
{
  "strategy_rank": {
    "title": "Strategy Rankings",
    "description": "Rankings are updated daily at 18:00 JST covering Nasdaq 100 and S&P 500 stocks.",
    "load_more": "Load More"
  }
}
```

åœ¨ `src/locales/zh.json`:
```json
{
  "strategy_rank": {
    "title": "ç­–ç•¥æ’å",
    "description": "æ’åæ¯å¤©ä¸œäº¬æ—¶é—´18:00æ›´æ–°,è¦†ç›–çº³æ–¯è¾¾å…‹100å’Œæ ‡æ™®500è‚¡ç¥¨ã€‚",
    "load_more": "åŠ è½½æ›´å¤š"
  }
}
```

åœ¨ `src/locales/ja.json`:
```json
{
  "strategy_rank": {
    "title": "æˆ¦ç•¥ãƒ©ãƒ³ã‚­ãƒ³ã‚°",
    "description": "ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã¯æ¯æ—¥18:00 JSTã«æ›´æ–°ã•ã‚Œã€Nasdaq 100ã¨S&P 500ã®éŠ˜æŸ„ã‚’ã‚«ãƒãƒ¼ã—ã¦ã„ã¾ã™ã€‚",
    "load_more": "ã‚‚ã£ã¨èª­ã¿è¾¼ã‚€"
  }
}
```

#### 4.4 æ·»åŠ å¯¼èˆª
åœ¨å¯¼èˆªç»„ä»¶ä¸­æ·»åŠ é“¾æ¥:
```typescript
<Link to="/rank">Strategy Rankings</Link>
```

---

### Phase 5: é¦–æ¬¡æµ‹è¯•è¿è¡Œ (30åˆ†é’Ÿ)

#### 5.1 å°è§„æ¨¡æµ‹è¯•
```bash
# åˆ›å»ºæµ‹è¯•ç”¨çš„å°è‚¡ç¥¨åˆ—è¡¨
echo -e "AAPL\nMSFT\nGOOGL\nAMZN\nNVDA" > backend/data/test_tickers.md

# ä¿®æ”¹scanner.pyä¸´æ—¶ä½¿ç”¨æµ‹è¯•åˆ—è¡¨
# è¿è¡Œæµ‹è¯•
python3 backend/scheduler/daily_scanner.py
```

#### 5.2 æ£€æŸ¥è¾“å‡º
```bash
# æŸ¥çœ‹è¿›åº¦
cat backend/data/scan_progress.txt

# æŸ¥çœ‹ç»“æœ
cat backend/data/rankings_combined.json | head -20

# æŸ¥çœ‹æ—¥å¿—
tail -50 backend/data/scan_log.txt
```

#### 5.3 å‰ç«¯æµ‹è¯•
```bash
# å¯åŠ¨å‰åç«¯
npm run dev  # å‰ç«¯
python3 backend/app.py  # åç«¯

# è®¿é—® http://localhost:3000/rank
```

---

### Phase 6: ç”Ÿäº§éƒ¨ç½² (1å°æ—¶)

#### 6.1 ä½¿ç”¨å¿«é€Ÿå¯åŠ¨è„šæœ¬
```bash
chmod +x quick_start.sh
./quick_start.sh
```

#### 6.2 æˆ–æ‰‹åŠ¨é…ç½®systemdæœåŠ¡
```bash
# åˆ›å»ºæœåŠ¡æ–‡ä»¶
sudo nano /etc/systemd/system/stock-scanner.service

# å†…å®¹è§quick_start.shä¸­çš„æ¨¡æ¿

# å¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl enable stock-scanner
sudo systemctl start stock-scanner

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status stock-scanner
```

#### 6.3 è®¾ç½®ç›‘æ§
```bash
# åˆ›å»ºç›‘æ§è„šæœ¬
cat > monitor.sh << 'EOF'
#!/bin/bash
echo "=== Stock Scanner Status ==="
systemctl is-active stock-scanner
cat backend/data/rankings_combined.json | grep "last_updated"
tail -5 backend/data/scan_progress.txt
EOF

chmod +x monitor.sh

# æ·»åŠ åˆ°crontab (æ¯å°æ—¶æ£€æŸ¥)
crontab -e
# æ·»åŠ : 0 * * * * /path/to/monitor.sh >> /path/to/monitor.log 2>&1
```

---

## âœ… éªŒè¯æ¸…å•

### åç«¯éªŒè¯
- [ ] Pythonä¾èµ–å®‰è£…æˆåŠŸ
- [ ] è‚¡ç¥¨åˆ—è¡¨æ–‡ä»¶å·²åˆ›å»ºï¼ˆnas100.md, sp500.mdï¼‰
- [ ] å»é‡åçš„è‚¡ç¥¨æ•°é‡æ­£ç¡®ï¼ˆçº¦500-600ä¸ªï¼‰
- [ ] æµ‹è¯•æ‰«ææˆåŠŸï¼ˆ5ä¸ªè‚¡ç¥¨ï¼‰
- [ ] APIç«¯ç‚¹å“åº”æ­£å¸¸
- [ ] å®šæ—¶ä»»åŠ¡é…ç½®æ­£ç¡®ï¼ˆ18:00 JSTï¼‰
- [ ] systemdæœåŠ¡è¿è¡Œæ­£å¸¸

### å‰ç«¯éªŒè¯
- [ ] StrategyRankç»„ä»¶æ­£å¸¸æ¸²æŸ“
- [ ] è·¯ç”±é…ç½®æ­£ç¡® (/rank)
- [ ] ç¿»è¯‘æ–‡ä»¶å·²æ›´æ–°
- [ ] å¯¼èˆªé“¾æ¥å·²æ·»åŠ 
- [ ] APIè°ƒç”¨æˆåŠŸ
- [ ] æ•°æ®æ­£ç¡®æ˜¾ç¤º
- [ ] åŠ è½½æ›´å¤šåŠŸèƒ½æ­£å¸¸

### ç³»ç»ŸéªŒè¯
- [ ] å®Œæ•´æ‰«ææˆåŠŸï¼ˆ500+è‚¡ç¥¨ï¼‰
- [ ] æ‰«ææ—¶é—´åœ¨1å°æ—¶å†…
- [ ] è¿›åº¦æ–‡ä»¶æ­£ç¡®è®°å½•
- [ ] ç»“æœæ–‡ä»¶æ ¼å¼æ­£ç¡®
- [ ] æ—¥å¿—æ–‡ä»¶æ­£å¸¸
- [ ] æ¬¡æ—¥å¯æ­£å¸¸è®¿é—®æ•°æ®

---

## ğŸ“Š é¢„æœŸç»“æœ

### æ‰«ææ€§èƒ½
- **æ€»è‚¡ç¥¨æ•°**: çº¦550ä¸ªï¼ˆå»é‡åï¼‰
- **æ‰«æé—´éš”**: 15ç§’/è‚¡ç¥¨
- **æ€»è€—æ—¶**: çº¦140åˆ†é’Ÿï¼ˆ2.3å°æ—¶ï¼‰
- **å¼€å§‹æ—¶é—´**: 18:00 JST
- **å®Œæˆæ—¶é—´**: 20:30 JST
- **æ•°æ®å¯ç”¨**: 19:00åå¯æŸ¥çœ‹éƒ¨åˆ†ç»“æœï¼Œ20:30åæŸ¥çœ‹å®Œæ•´ç»“æœ

### æ•°æ®äº§å‡º
```
backend/data/
â”œâ”€â”€ rankings_combined.json     # ~200KB (å®Œæ•´æ•°æ®)
â”œâ”€â”€ rankings_top20.json        # ~10KB (å¿«é€Ÿè®¿é—®)
â”œâ”€â”€ scan_progress.txt          # ~50KB (è¿›åº¦è®°å½•)
â”œâ”€â”€ scan_log.txt              # ~500KB (è¯¦ç»†æ—¥å¿—)
â””â”€â”€ scheduler.log             # ~100KB (å®šæ—¶ä»»åŠ¡æ—¥å¿—)
```

---

## ğŸ”§ ä¼˜åŒ–å»ºè®®

### å¦‚æœæ‰«æå¤ªæ…¢
```yaml
# åœ¨config.yamlä¸­è°ƒæ•´
scanner:
  request_interval: 10  # ä»15ç§’å‡å°‘åˆ°10ç§’
```

### å¦‚æœé‡åˆ°rate limit
```yaml
scanner:
  request_interval: 20  # å¢åŠ åˆ°20ç§’
  max_retries: 5        # å¢åŠ é‡è¯•æ¬¡æ•°
```

### å¦‚æœå†…å­˜ä¸è¶³
```yaml
scanner:
  batch_checkpoint: 5   # æ›´é¢‘ç¹åœ°ä¿å­˜ä¸­é—´ç»“æœ
```

---

## ğŸ“ æ”¯æŒå’Œè°ƒè¯•

### æŸ¥çœ‹å®æ—¶è¿›åº¦
```bash
# æ–¹æ³•1: æŸ¥çœ‹è¿›åº¦æ–‡ä»¶
tail -f backend/data/scan_progress.txt

# æ–¹æ³•2: æŸ¥çœ‹æ—¥å¿—
tail -f backend/data/scan_log.txt

# æ–¹æ³•3: æŸ¥çœ‹systemdæ—¥å¿—
sudo journalctl -u stock-scanner -f
```

### å¸¸è§é—®é¢˜

**Q: æ‰«æå¡ä½ä¸åŠ¨**
```bash
# æ£€æŸ¥æœ€åå¤„ç†çš„è‚¡ç¥¨
tail -1 backend/data/scan_progress.txt

# æ£€æŸ¥æ˜¯å¦æœ‰ERROR
grep "ERROR" backend/data/scan_log.txt

# é‡å¯æ‰«æ
sudo systemctl restart stock-scanner
```

**Q: æ•°æ®ä¸æ›´æ–°**
```bash
# æ£€æŸ¥å®šæ—¶ä»»åŠ¡
sudo systemctl status stock-scanner

# æ£€æŸ¥æ—¶åŒºè®¾ç½®
timedatectl

# æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡
python3 backend/scheduler/scheduler_manager.py --now
```

**Q: APIè¿”å›404**
```bash
# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -lh backend/data/rankings_*.json

# æ‰‹åŠ¨è¿è¡Œä¸€æ¬¡æ‰«æ
python3 backend/scheduler/daily_scanner.py
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **ç›‘æ§è®¾ç½®**: é…ç½®å‘Šè­¦ç³»ç»Ÿï¼ˆé‚®ä»¶/Webhookï¼‰
2. **æ€§èƒ½ä¼˜åŒ–**: æ ¹æ®å®é™…è¿è¡Œæƒ…å†µè°ƒæ•´å‚æ•°
3. **åŠŸèƒ½æ‰©å±•**: æ·»åŠ æ›´å¤šç­›é€‰å’Œæ’åºé€‰é¡¹
4. **æ•°æ®åˆ†æ**: æ·»åŠ å†å²è¶‹åŠ¿åˆ†æ
5. **ç§»åŠ¨é€‚é…**: ä¼˜åŒ–ç§»åŠ¨ç«¯æ˜¾ç¤º

---

## ğŸ“ é¡¹ç›®æ—¶é—´çº¿

| é˜¶æ®µ | ä»»åŠ¡ | é¢„è®¡æ—¶é—´ | çŠ¶æ€ |
|------|------|----------|------|
| 1 | ç¯å¢ƒå‡†å¤‡å’Œä¾èµ–å®‰è£… | 15åˆ†é’Ÿ | â³ |
| 2 | åˆå§‹åŒ–æ•°æ®å’Œè‚¡ç¥¨åˆ—è¡¨ | 20åˆ†é’Ÿ | â³ |
| 3 | åç«¯APIé›†æˆ | 30åˆ†é’Ÿ | â³ |
| 4 | å‰ç«¯ç»„ä»¶å¼€å‘ | 30åˆ†é’Ÿ | â³ |
| 5 | é¦–æ¬¡æµ‹è¯•è¿è¡Œ | 30åˆ†é’Ÿ | â³ |
| 6 | ç”Ÿäº§éƒ¨ç½²å’Œç›‘æ§ | 1å°æ—¶ | â³ |
| **æ€»è®¡** | | **~3å°æ—¶** | |

---

## ğŸ‰ å®Œæˆæ ‡å¿—

å½“ä»¥ä¸‹æ¡ä»¶éƒ½æ»¡è¶³æ—¶ï¼Œç³»ç»Ÿå³ä¸ºæˆåŠŸéƒ¨ç½²:

âœ… systemdæœåŠ¡æ˜¾ç¤º "active (running)"
âœ… å®šæ—¶ä»»åŠ¡åœ¨18:00 JSTè‡ªåŠ¨æ‰§è¡Œ
âœ… æ‰«æåœ¨20:30å‰å®Œæˆ
âœ… rankings_combined.jsonåŒ…å«500+æ¡è®°å½•
âœ… å‰ç«¯é¡µé¢/rankæ­£å¸¸æ˜¾ç¤ºæ•°æ®
âœ… æ¯å¤©è‡ªåŠ¨æ›´æ–°,æ— éœ€äººå·¥å¹²é¢„

æ­å–œ! ğŸŠ ä½ çš„æ¯æ—¥è‚¡ç¥¨æ‰«æç³»ç»Ÿå·²æˆåŠŸä¸Šçº¿!