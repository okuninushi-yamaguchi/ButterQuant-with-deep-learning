# 开发日志：2026-01-12 | ButterQuant v1.2 "AI 觉醒"

## 🟢 今日目标：深度学习集成与实盘交易闭环

今天完成了 ButterQuant 项目上线以来最重磅的一次升级，核心目标是将“AI 预测”与“实盘执行”进行物理连接，正式开启 v1.2 版本。

## 🚀 核心工作内容

### 1. 深度学习 (Deep Learning) 全线打通
- **推理引擎接入**：在后端 `analyzer.py` 中集成了基于 ONNX Runtime 的成功率预测模型。系统现在能为每一笔蝴蝶策略给出一个 0-1 之间的“AI 胜率分”。
- **UI 视觉增强**：在前端详情页新增了“AI Success Probability”卡片。采用了紫色渐变、信心进度条等高保真设计，显著提升了工具的专业感。
- **ML 工作流文档化**：创建了 `ML_GUIDE.md` 和 `export_onnx.py`。明确了“数据标记 -> 模型训练 -> ONNX 导出 -> 后端更新”的标准化流程。

### 2. IBKR 交易引擎实现
- **`trader.py` 模块开发**：利用 `ib_insync` 实现了与盈透证券 (Interactive Brokers) 的稳定连接。
- **自动组合腿下单**：实现了三腿 Butterfly 的原生 Combo 订单生成逻辑（BAG 订单），无需手动分步执行。
- **虚拟策略隔离**：利用 `orderRef` 给订单打标签。通过 `ButterAI` vs `ButterBaseline` 的分类，实现在同一个账户里进行“模型单”与“传统单”的 A/B 测试。

### 3. “交易日志”仪表盘上线
- **全栈监控回路**：
    - **数据库端**：增加了 `trades_history` 表，用于永久保存成交记录。
    - **服务端**：增加了 `/api/trades` 接口。
    - **客户端**：新增了 `TradeJournal.tsx` 页面。
- **功能点**：用户可以在该面板实时查看交易状态、订单来源（AI 还是 Baseline）、执行价格以及初步的胜率统计。

### 4. 项目规范与文档
- **版本归档**：全面整理了中英文 README，将版本号正式锁定为 **v1.2 with Deep Learning**，并同步推送到 GitHub 仓库并打标。
- **基础设施优化**：
    - 修复了 NAS100 标签路径在部分环境下的加载错误。
    - 提供了 `environment_gpu.yml` 配置文件，适配了 RTX 4060 的 Anaconda 训练环境。

---

## 📈 后期规划 (Next Steps)
1. **实战数据积累**：建议每天运行 `daily_scanner.py` 以累积原始特征数据，至少积累 50 条交易记录后进行第一次模型重训练。
2. **GPU 环境部署**：辅助用户在本地 Anaconda 中完成训练环境的搭建。
3. **夏普比率计算**：下一步将在交易日志页面加入动态夏普比率 (Sharpe Ratio) 和回撤统计。

---
*记录人：Antigravity AI (心力物语 - Deep Learning 专题组)*
