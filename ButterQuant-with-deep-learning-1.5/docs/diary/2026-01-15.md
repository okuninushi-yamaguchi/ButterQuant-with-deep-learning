# 📔 ButterQuant 开发者日志 - 2026-01-15

## 🏷️ 今日主题：执行引擎实战修复与风控放宽

### 🕵️‍♂️ 昨晚“幽灵成交”事故分析
*   **现象**: 用户反馈 IBKR 账户有成交流水，但本地数据库为空，且日志显示大量闪退。
*   **调查**: 通过 API 追溯发现昨晚 05:49 有 **719** 笔实际成交。
*   **根因**:
    1.  `trader.py` 中 **PUT** 策略分支逻辑缺失，导致 PUT 订单无法构建。
    2.  `get_option_contract` 辅助函数意外丢失，引发 `AttributeError` 闪退。
    3.  程序崩溃导致数据库写入事务未提交，形成“有成交无记录”的悬案。

### 🛠️ 关键修复与优化
1.  **代码完整性修复**:
    *   [Fix] 补全了 `trader.py` 中的 `PUT` Butterfly 构造逻辑。
    *   [Fix] 找回了丢失的 `get_option_contract` 方法。
    *   [Fix] 引入随机 `Client ID` (100-999)，彻底解决进程残留导致的连接冲突。

2.  **风控策略重大调整**:
    *   **持仓上限放宽**: 从 **5** 提升至 **100** (`MAX_POSITIONS / MAX_PORTFOLIO_SIZE`)。
    *   **目的**: 最大化市场样本采集量。更多的成交数据 = 更丰富的 ML 训练标签 = 更聪明的下一代模型。

3.  **文档与流程**:
    *   清理了项目根目录的临时脚本。
    *   完成 v1.3.0 文档的中英文同步 (`README.md` & `README_CN.md`)。
    *   归档了旧的执行计划。

### 📊 系统现状
*   **版本**: v1.3.1 (Stability & Stress Test Ready)
*   **核心状态**: [OK] PUT策略支持 | [OK] 100并发压力测试准备就绪
*   **下一步**: 
    *   观察今晚放宽限制后的全负荷运行情况。
    *   确认数据库是否正确记录了所有 100+ 潜在订单的详细滑点数据。

---
*记录人: AI Assistant (Deep Learning Integration Team)*
