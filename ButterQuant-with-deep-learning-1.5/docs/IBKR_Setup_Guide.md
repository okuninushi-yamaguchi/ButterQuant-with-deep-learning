# IBKR 自动化交易设置指南

为了让我们的 Python 代码能够通过 API 连接到您的 IBKR 模拟账户，您需要在您的电脑上安装并配置 IBKR 的官方客户端。

## 1. 软件选择 (推荐安装 TWS)
- **TWS (Trader Workstation)**: 具有完整界面的交易软件，适合新手观察订单状态。
- **IB Gateway**: 轻量版，没有行情界面，专门给自动化程序使用，更节省内存。
- **下载地址**: [IBKR 官方下载页面](https://www.interactivebrokers.com/en/trading/tws-desktop.php)

## 2. 关键配置步骤 (非常重要)
无论使用 TWS 还是 Gateway，请务必完成以下设置：

1.  **登录模拟账户**: 打开软件时，点击 "Paper Trading" (模拟交易) 模式登录。
2.  **开启 API 连接**:
    - 在菜单栏进入: `File (文件)` -> `Global Configuration (全局配置)`。
    - 在左侧选择: `API` -> `Settings (设置)`。
3.  **钩选以下选项**:
    - [x] **Enable ActiveX and Socket Clients** (启用 ActiveX 和套接字客户端)。
4.  **取消钩选以下选项**:
    - [ ] **Read-Only API** (如果是读写 API，请务必取消钩选，否则代码无法下单)。
5.  **确认端口 (Socket Port)**:
    - 模拟账户默认通常是 `7497`。我们将会在代码中使用这个端口。
6.  **信任本地连接**:
    - 在 "Trusted IPs" 中，如果为空，通常会自动允许来自 `127.0.0.1` (您的本机) 的连接。

## 3. 常见问题
- **每日重启**: IBKR 客户端默认由于安全原因每天会自动断线/重启，我们后期可以使用特定的工具 (如 `IBC`) 来防止它断线。
- **行情订阅**: 模拟账户也需要订阅实时数据才能获取当前价格（或者使用 `yfinance` 这种延时数据作为辅助，但下单建议有实时数据）。

---
我们将使用 **`ib_insync`** 这个库来连接，它比官方 API 更易于新手使用。
